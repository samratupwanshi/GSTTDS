<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GST Lookup & Payouts</title>
  <style>
    /* Your oceanic theme and layout from before… */
    body { margin:0; font-family: Inter, sans-serif; background: linear-gradient(180deg,#f2f9ff,#fff); color:#0b2740; }
    header { background: linear-gradient(90deg,#0b74c4,#065a9e); color:#fff; padding:18px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:18px; }
    header .subtitle { font-size:12px; opacity:0.95; }
    .btn { background:#0b74c4; color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
    .btn.secondary { background:#eef6fb; color:#065a9e; border:1px solid rgba(11,116,196,0.08); }
    .container { display:grid; grid-template-columns:1fr 360px; gap:18px; max-width:1100px; margin:20px auto; padding:18px; }
    .panel { background:#fff; border-radius:8px; padding:16px; box-shadow:0 6px 20px rgba(11,116,196,0.06); }
    input[type=text] { width:100%; padding:10px; border-radius:8px; border:1px solid #e6eef9; }
    .muted { font-size:13px; color:#6b7280; }
    .result-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
    .field { background:linear-gradient(180deg,#fff,#fbfdff); border-radius:8px; padding:10px; border:1px solid #eef6fb; font-size:13px; }
    table.prev { width:100%; border-collapse:collapse; font-size:13px; margin-top:12px; }
    table.prev th, table.prev td { padding:8px; text-align:left; border-bottom:1px dashed #eef6fb; }
    footer { text-align:center; font-size:13px; color:#6b7280; padding:14px 20px; margin-top:20px; }
    @media(max-width:980px) { .container { grid-template-columns:1fr; } }
  </style>
</head>
<body>
<header>
  <div><h1>GST Lookup & Payouts</h1><div class="subtitle">Software developed by S World — Complete Accounting Solutions</div></div>
</header>

<main class="container">
  <!-- Left panel -->
  <section class="panel">
    <h3>Search GST Number</h3>
    <div class="muted">Enter 15-digit GSTIN and press Search.</div>
    <div style="margin-top:12px;">
      <input id="gstInput" type="text" placeholder="Example: 06AACCG0527D1Z8" maxlength="15" />
      <button id="searchBtn" class="btn">Search</button>
    </div>
    <div id="message" class="muted" style="margin-top:10px;"></div>
    <div id="result" style="display:none; margin-top:14px;">
      <h4>GST Details</h4>
      <div class="result-grid">
        <div class="field"><strong>GSTIN</strong><div id="r_gstin"></div></div>
        <div class="field"><strong>Legal Name</strong><div id="r_legal"></div></div>
        <div class="field"><strong>Trade Name</strong><div id="r_trade"></div></div>
        <div class="field"><strong>Status</strong><div id="r_status"></div></div>
        <div class="field"><strong>Reg. Date</strong><div id="r_reg"></div></div>
        <div class="field"><strong>Last Update</strong><div id="r_last"></div></div>
        <div class="field"><strong>Type</strong><div id="r_type"></div></div>
        <div class="field"><strong>Business Type</strong><div id="r_btype"></div></div>
      </div>
      <h4 style="margin-top:12px;">Address</h4>
      <div class="field" id="r_address"></div>
    </div>
  </section>

  <!-- Right panel -->
  <aside class="panel">
    <h3>Previous Lookups</h3>
    <table class="prev" id="prevTable">
      <thead><tr><th>GSTIN</th><th>Legal Name</th><th>Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </aside>
</main>

<footer>© Utsaah Foundation — built for quick GST checks.</footer>

<script>
function validateGSTIN(g) {
  return /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z][1-9A-Z]Z[0-9A-Z]$/.test(g);
}

document.getElementById('searchBtn').addEventListener('click', searchGST);
document.getElementById('gstInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') searchGST();
});

function searchGST() {
  const gst = document.getElementById('gstInput').value.trim().toUpperCase();
  const msg = document.getElementById('message');
  const res = document.getElementById('result');

  msg.textContent = ''; res.style.display = 'none';
  if (!validateGSTIN(gst)) {
    msg.textContent = 'Invalid GSTIN format';
    return;
  }

  fetch(`backend.php?gstin=${gst}`)
    .then(r => r.json())
    .then(json => {
      if (!(json.flag && json.data)) {
        msg.textContent = json.message || 'Not found';
        return;
      }
      const d = json.data;
      msg.textContent = '';
      document.getElementById('r_gstin').textContent = d.gstin;
      document.getElementById('r_legal').textContent = d.lgnm;
      document.getElementById('r_trade').textContent = d.tradeNam;
      document.getElementById('r_status').textContent = d.sts;
      document.getElementById('r_reg').textContent = d.rgdt;
      document.getElementById('r_last').textContent = d.lstupdt;
      document.getElementById('r_type').textContent = d.dty;
      document.getElementById('r_btype').textContent = d.ctb;

      const addr = d.pradr?.addr;
      document.getElementById('r_address').textContent = addr
        ? [addr.bno, addr.bnm, addr.st, addr.loc, addr.dst, addr.stcd, addr.pncd].filter(Boolean).join(', ')
        : '—';

      res.style.display = '';
      // Add to previous table
      const tbody = document.querySelector('#prevTable tbody');
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${d.gstin}</td><td>${d.lgnm}</td><td>${new Date().toISOString().slice(0,10)}</td>`;
      tbody.prepend(tr);
    })
    .catch(err => {
      console.error(err);
      msg.textContent = 'Error fetching GST data.';
    });
}
</script>
</body>
</html>